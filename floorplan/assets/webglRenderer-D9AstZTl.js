import{V as e,a as t,R as s,W as i,P as a,S as r,A as o,b as n,C as h,G as l,c,d,D as m,M as p,L as u,e as w,f as g,B as f,g as v,h as M}from"./three-DPD25GbA.js";class y{#e=null;#t=null;#s=null;#i=null;#a=null;#r=null;#o=null;#n=null;#h=new Map;#l=new Map;#c=new Map;#d=new Map;#m=new Map;#p=null;#u=null;#w=!0;#g={wall:null,floor:null,ceiling:null,door:null,window:null,wireframe:null};#f=!1;#v=!1;#M=3;#y=null;#b=null;#C={position:new e(10,8,10),target:new e(0,0,0),defaultFov:60};#S=null;#L=null;#D=null;#E=null;constructor(e){if(this.#e=document.getElementById(e),!this.#e)throw new Error(`Canvas element with ID '${e}' not found`);this.#o=new t,this.#r=new s,this.#S=this.#z.bind(this),this.#L=this.#W.bind(this),this.#D=this.#x.bind(this),this.#E=this.#P.bind(this)}async initialize(){try{await this.#G(),this.#R(),this.#k(),this.#A(),this.#F(),this.#I(),this.#O(),this.#H(),this.#f=!0}catch(e){throw new Error(`WebGL renderer initialization failed: ${e.message}`)}}async#G(){if(!this.#K())throw new Error("WebGL is not supported in this browser");this.#i=new i({canvas:this.#e,antialias:!0,alpha:!1,powerPreference:"high-performance"}),this.#i.setSize(this.#e.clientWidth,this.#e.clientHeight),this.#i.setPixelRatio(Math.min(window.devicePixelRatio,2)),this.#i.setClearColor(16119285,1),this.#i.shadowMap.enabled=!0,this.#i.shadowMap.type=a,this.#i.outputColorSpace=r,this.#i.toneMapping=o,this.#i.toneMappingExposure=1}#R(){this.#t=new n,this.#t.background=new h(16119285),this.#n=new l,this.#n.name="floorPlan",this.#t.add(this.#n)}#k(){const e=this.#e.clientWidth/this.#e.clientHeight;this.#s=new c(this.#C.defaultFov,e,.1,1e3),this.#s.position.copy(this.#C.position),this.#s.lookAt(this.#C.target)}#A(){this.#p=new d(4210752,.6),this.#p.name="ambientLight",this.#t.add(this.#p),this.#u=new m(16777215,1),this.#u.position.set(10,10,5),this.#u.castShadow=!0,this.#u.name="directionalLight",this.#u.shadow.mapSize.width=2048,this.#u.shadow.mapSize.height=2048,this.#u.shadow.camera.near=.5,this.#u.shadow.camera.far=50,this.#u.shadow.camera.left=-20,this.#u.shadow.camera.right=20,this.#u.shadow.camera.top=20,this.#u.shadow.camera.bottom=-20,this.#t.add(this.#u)}#F(){this.#g.wall=new p({color:14737632,transparent:!1}),this.#g.floor=new p({color:13940886,transparent:!1}),this.#g.ceiling=new p({color:16777215,transparent:!1}),this.#g.door=new p({color:9127187,transparent:!1}),this.#g.window=new p({color:8900331,transparent:!0,opacity:.7}),this.#g.wireframe=new u({color:0,linewidth:1})}#I(){this.#a={enabled:!0,rotateSpeed:1,zoomSpeed:1,panSpeed:1,autoRotate:!1,isRotating:!1,isPanning:!1,rotateStart:new t,panStart:new t,spherical:new w,sphericalDelta:new w,panOffset:new e,scale:1};const s=new e;s.copy(this.#s.position).sub(this.#C.target),this.#a.spherical.setFromVector3(s)}#O(){let e;this.#e.addEventListener("mousedown",this.#j.bind(this)),this.#e.addEventListener("mousemove",this.#S),this.#e.addEventListener("mouseup",this.#B.bind(this)),this.#e.addEventListener("wheel",this.#V.bind(this)),this.#e.addEventListener("click",this.#L),this.#e.addEventListener("keydown",this.#D),window.addEventListener("resize",this.#E),this.#b=new ResizeObserver((()=>{clearTimeout(e),e=setTimeout((()=>{this.#P()}),16)})),this.#b.observe(this.#e),this.#e.addEventListener("contextmenu",(e=>e.preventDefault()))}async generateModel(e){try{if(!this.#f)throw new Error("Renderer not initialized");this.#U(),await this.#Y(e.walls),await this.#$(e.floors),await this.#N(e.ceilings),await this.#T(e.doors),await this.#X(e.windows),this.#q(e.metadata.bounds)}catch(t){throw new Error(`3D model generation failed: ${t.message}`)}}async#Y(e){for(const s of e)try{const e=this.#J(s),t=this.#v?this.#g.wireframe:this.#g.wall,i=new g(e,t);i.name=s.id,i.userData={type:"wall",data:s},i.castShadow=!0,i.receiveShadow=!0,this.#h.set(s.id,i),this.#n.add(i)}catch(t){}}#J(e){const{vertices:t,faces:s}=e,i=new f,a=new Float32Array(3*t.length);for(let o=0;o<t.length;o++){const e=t[o];a[3*o]=e.x,a[3*o+1]=e.y,a[3*o+2]=e.z}const r=[];for(const o of s)r.push(o[0],o[1],o[2]);return i.setAttribute("position",new v(a,3)),i.setIndex(r),i.computeVertexNormals(),i}async#$(e){for(const s of e)try{const e=this.#Q(s),t=this.#v?this.#g.wireframe:this.#g.floor,i=new g(e,t);i.name=s.id,i.userData={type:"floor",data:s},i.receiveShadow=!0,this.#l.set(s.id,i),this.#n.add(i)}catch(t){}}async#N(e){for(const s of e)try{const e=this.#Q(s),t=this.#v?this.#g.wireframe:this.#g.ceiling,i=new g(e,t);i.name=s.id,i.userData={type:"ceiling",data:s},this.#c.set(s.id,i),this.#n.add(i)}catch(t){}}async#T(e){for(const s of e)try{const e=this.#Z(s),t=this.#v?this.#g.wireframe:this.#g.door,i=new g(e,t);i.name=s.id,i.userData={type:"door",data:s},this.#d.set(s.id,i),this.#n.add(i)}catch(t){}}async#X(e){for(const s of e)try{const e=this.#_(s),t=this.#v?this.#g.wireframe:this.#g.window,i=new g(e,t);i.name=s.id,i.userData={type:"window",data:s},this.#m.set(s.id,i),this.#n.add(i)}catch(t){}}#Q(e){const{vertices:t,faces:s}=e,i=new f,a=new Float32Array(3*t.length);for(let o=0;o<t.length;o++)a[3*o]=t[o].x,a[3*o+1]=t[o].y,a[3*o+2]=t[o].z;const r=[];for(const o of s)r.push(o[0],o[1],o[2]);return i.setAttribute("position",new v(a,3)),i.setIndex(r),i.computeVertexNormals(),i}#Z(e){const{position:t,width:s,height:i,thickness:a}=e,r=new M(.8*a,i,s);return r.translate(t.x,t.y+i/2,t.z),r}#_(e){const{position:t,width:s,height:i,sillHeight:a,thickness:r}=e,o=new M(.6*r,i,s);return o.translate(t.x,a+i/2,t.z),o}#U(){this.#h.forEach((e=>{this.#n.remove(e),e.geometry.dispose()})),this.#h.clear(),this.#l.forEach((e=>{this.#n.remove(e),e.geometry.dispose()})),this.#l.clear(),this.#c.forEach((e=>{this.#n.remove(e),e.geometry.dispose()})),this.#c.clear(),this.#d.forEach((e=>{this.#n.remove(e),e.geometry.dispose()})),this.#d.clear(),this.#m.forEach((e=>{this.#n.remove(e),e.geometry.dispose()})),this.#m.clear()}#q(e){if(!e)return;const{width:t,height:s}=e,i=1.5*Math.max(t,s);this.#C.position.set(i,.8*i,i),this.#C.target.set(0,0,0),this.#s.position.copy(this.#C.position),this.#s.lookAt(this.#C.target),this.#ee()}#j(e){if(!this.#a.enabled)return;e.preventDefault();const t=this.#e.getBoundingClientRect(),s=(e.clientX-t.left)/t.width*2-1,i=-(e.clientY-t.top)/t.height*2+1;0===e.button?(this.#a.isRotating=!0,this.#a.rotateStart.set(s,i)):2===e.button&&(this.#a.isPanning=!0,this.#a.panStart.set(s,i)),this.#e.style.cursor="grabbing"}#z(e){if(!this.#a.enabled)return;const t=this.#e.getBoundingClientRect(),s=(e.clientX-t.left)/t.width*2-1,i=-(e.clientY-t.top)/t.height*2+1;if(this.#o.set(s,i),this.#a.isRotating){const e=s-this.#a.rotateStart.x,t=i-this.#a.rotateStart.y;this.#a.sphericalDelta.theta-=e*this.#a.rotateSpeed,this.#a.sphericalDelta.phi-=t*this.#a.rotateSpeed,this.#a.rotateStart.set(s,i),this.#ee()}else if(this.#a.isPanning){const e=s-this.#a.panStart.x,t=i-this.#a.panStart.y;this.#te(e,t),this.#a.panStart.set(s,i)}}#B(e){this.#a.enabled&&(this.#a.isRotating=!1,this.#a.isPanning=!1,this.#e.style.cursor="default")}#V(e){if(!this.#a.enabled)return;e.preventDefault();const t=e.deltaY>0?1.1:.9;this.#se(t)}#W(e){this.#r.setFromCamera(this.#o,this.#s);const t=this.#r.intersectObjects(this.#n.children);if(t.length>0){t[0].object}}#x(e){if(!this.#a.enabled)return;const{key:t}=e;let s=!1;switch(t){case"ArrowUp":this.#a.sphericalDelta.phi-=.1,s=!0;break;case"ArrowDown":this.#a.sphericalDelta.phi+=.1,s=!0;break;case"ArrowLeft":this.#a.sphericalDelta.theta-=.1,s=!0;break;case"ArrowRight":this.#a.sphericalDelta.theta+=.1,s=!0;break;case"+":case"=":this.#se(.9),s=!0;break;case"-":this.#se(1.1),s=!0}s&&(e.preventDefault(),this.#ee())}#P(){if(!this.#s||!this.#i)return;const e=this.#e.getBoundingClientRect(),s=Math.max(e.width||this.#e.offsetWidth||800,400),i=Math.max(e.height||this.#e.offsetHeight||500,300),a=this.#i.getSize(new t);if(Math.abs(a.x-s)<1&&Math.abs(a.y-i)<1)return;this.#s.aspect=s/i,this.#s.updateProjectionMatrix(),this.#i.setSize(s,i,!1);const r=Math.min(window.devicePixelRatio||1,2);this.#i.setPixelRatio(r)}#ee(){this.#a.spherical.theta+=this.#a.sphericalDelta.theta,this.#a.spherical.phi+=this.#a.sphericalDelta.phi,this.#a.spherical.phi=Math.max(.1,Math.min(Math.PI-.1,this.#a.spherical.phi)),this.#a.spherical.makeSafe();const t=new e;t.setFromSpherical(this.#a.spherical),this.#s.position.copy(this.#C.target).add(t),this.#s.lookAt(this.#C.target),this.#a.sphericalDelta.set(0,0,0)}#te(t,s){const i=new e;i.copy(this.#s.position).sub(this.#C.target);let a=i.length();a*=Math.tan(this.#s.fov/2*Math.PI/180);const r=new e;r.setFromMatrixColumn(this.#s.matrix,0),r.multiplyScalar(-2*t*a/this.#e.clientHeight);const o=new e;o.setFromMatrixColumn(this.#s.matrix,1),o.multiplyScalar(2*s*a/this.#e.clientHeight),this.#C.target.add(r).add(o),this.#s.position.add(r).add(o)}#se(e){this.#a.spherical.radius*=e,this.#a.spherical.radius=Math.max(1,Math.min(100,this.#a.spherical.radius)),this.#ee()}#H(){const e=()=>{this.#y=requestAnimationFrame(e),this.#ie()};e()}#ie(){this.#i&&this.#t&&this.#s&&this.#i.render(this.#t,this.#s)}#K(){try{const e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}resetCamera(){this.#C.position.set(10,8,10),this.#C.target.set(0,0,0),this.#s.position.copy(this.#C.position),this.#s.lookAt(this.#C.target),this.#ee()}toggleWireframe(){this.#v=!this.#v;return[...this.#h.values(),...this.#l.values(),...this.#c.values(),...this.#d.values(),...this.#m.values()].forEach((e=>{if(this.#v)e.material=this.#g.wireframe;else{const t=e.userData.type;e.material=this.#g[t]}})),this.#v}toggleLighting(){return this.#w=!this.#w,this.#p.visible=this.#w,this.#u.visible=this.#w,this.#w}updateWallHeight(e){this.#M=e,this.#h.forEach((t=>{const s=t.userData.data;t.scale.y=e/s.height})),this.#d.forEach((t=>{const s=t.userData.data;t.scale.y=Math.min(e/s.height,1)}))}rotateCamera(e,t){this.#a.sphericalDelta.theta+=e,this.#a.sphericalDelta.phi+=t,this.#ee()}zoomCamera(e){this.#se(e)}dispose(){this.#y&&cancelAnimationFrame(this.#y),this.#e?.removeEventListener("mousemove",this.#S),this.#e?.removeEventListener("click",this.#L),this.#e?.removeEventListener("keydown",this.#D),window.removeEventListener("resize",this.#E),this.#b?.disconnect(),this.#U(),Object.values(this.#g).forEach((e=>{e?.dispose()})),this.#i?.dispose()}}export{y as default};
